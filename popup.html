<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>下班時間計算器</title>
    <link rel="stylesheet" href="popup.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>🕐 下班時間計算器</h1>
        </header>

        <!-- 登入區域 -->
        <div id="loginSection" class="section hidden">
            <h3>登入出勤系統</h3>

            <!-- API 設定區域 -->
            <div class="settings-toggle">
                <button id="toggleApiSettings" class="btn btn-secondary">⚙️ API 設定</button>
            </div>

            <div id="apiSettingsSection" class="api-settings hidden">
                <div class="input-group">
                    <label for="companyDomain">公司域名：</label>
                    <input type="text" id="companyDomain" placeholder="例如：gigabyte" value="company">
                </div>
                <div class="input-group">
                    <label for="loginApiUrl">登入 API：</label>
                    <input type="url" id="loginApiUrl" placeholder="https://your-company-api.com/api/auth/login" value="https://your-company-api.com/api/auth/login">
                </div>
                <div class="input-group">
                    <label for="attendanceApiUrl">出勤查詢 API：</label>
                    <input type="url" id="attendanceApiUrl" placeholder="https://your-company-api.com/api/getAttendanceInfo" value="https://your-company-api.com/api/getAttendanceInfo">
                </div>
                <div class="input-group">
                    <button id="saveApiSettings" class="btn btn-primary">💾 儲存 API 設定</button>
                    <button id="resetApiSettings" class="btn btn-secondary">🔄 重置為預設</button>
                </div>
            </div>

            <!-- 登入表單 -->
            <div class="input-group">
                <label for="username">使用者名稱：</label>
                <div class="username-input">
                    <span id="usernamePrefix" class="username-prefix">company\</span>
                    <input type="text" id="username" placeholder="username" value="">
                </div>
            </div>
            <div class="input-group">
                <label for="password">密碼：</label>
                <input type="password" id="password" placeholder="請輸入密碼" value="">
            </div>
            <div class="input-group">
                <label class="checkbox-label">
                    <input type="checkbox" id="rememberCredentials" checked>
                    <span class="checkmark"></span>
                    記住帳號密碼
                </label>
            </div>
            <button id="loginBtn" class="btn primary">登入</button>
            <button id="skipLoginBtn" class="btn secondary">跳過登入 (使用測試 Key)</button>
            <div id="loginStatus" class="status">
                <span class="status-text"></span>
                <button class="status-close" onclick="clearStatus(this.parentElement)" style="display:none;">×</button>
            </div>
        </div>

        <!-- 主要功能區域 -->
        <div id="mainSection" class="section">
            <!-- 當前時間顯示 -->
            <div class="time-display">
                <div class="current-time">
                    <span id="currentTime">--:--:--</span>
                </div>
                <div class="current-date">
                    <span id="currentDate">----/--/--</span>
                </div>
            </div>

            <!-- 上班時間設定 -->
            <div class="work-time-section">
                <h3>今日上班時間</h3>
                <div class="input-group">
                    <label for="workStartTime">上班時間：</label>
                    <input type="time" id="workStartTime" value="09:30">
                    <button id="autoDetectBtn" class="btn secondary">自動偵測</button>
                </div>
                <div id="detectionStatus" class="status"></div>
            </div>

            <!-- 下班時間計算結果 -->
            <div class="result-section">
                <div class="work-schedule">
                    <div class="schedule-item">
                        <span class="label">預計下班時間：</span>
                        <span id="endTime" class="time-value">--:--</span>
                    </div>
                    <div class="schedule-item">
                        <span class="label">距離下班：</span>
                        <span id="remainingTime" class="time-value countdown">--:--:--</span>
                    </div>
                    <div class="schedule-item">
                        <span class="label">工作進度：</span>
                        <div class="progress-container">
                            <div class="progress-bar">
                                <div id="progressFill" class="progress-fill"></div>
                            </div>
                            <span id="progressText" class="progress-text">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 彈性上班制度說明 -->
            <div class="info-section">
                <h4>📋 彈性上班制度</h4>
                <ul class="rule-list">
                    <li>彈性上班時間：8:30-9:30</li>
                    <li>8:30 上班 → 17:45 下班</li>
                    <li>8:30-9:30 之間：固定工作 9小時15分鐘</li>
                    <li>9:30 上班 → 18:45 下班</li>
                    <li>超過 9:30 → 18:45 下班</li>
                </ul>
            </div>

            <!-- 控制按鈕 -->
            <div class="control-section">
                <button id="refreshBtn" class="btn secondary">🔄 重新整理</button>
                <button id="testBtn" class="btn secondary">🧪 測試 API</button>
                <button id="settingsBtn" class="btn secondary">⚙️ 設定</button>
                <button id="logoutBtn" class="btn danger">登出</button>
            </div>
        </div>

        <!-- 設定區域 -->
        <div id="settingsSection" class="section hidden">
            <h3>設定</h3>
            <div class="setting-group">
                <label>
                    <input type="checkbox" id="autoRefresh"> 自動重新整理 (每分鐘)
                </label>
            </div>
            <div class="setting-group">
                <label>
                    <input type="checkbox" id="showNotification"> 下班提醒通知
                </label>
            </div>
            <button id="backToMainBtn" class="btn secondary">返回主頁</button>
        </div>
    </div>

    <script src="popup.js"></script>
</body>
</html>
