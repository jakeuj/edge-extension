<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API è¨­å®šæ¸¬è©¦</title>
    <link rel="stylesheet" href="popup.css">
    <style>
        body {
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #495057;
        }
        .current-settings {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .current-settings pre {
            margin: 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #495057;
        }
        .test-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 6px;
            font-weight: 500;
        }
        .test-result.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-result.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”§ API è¨­å®šåŠŸèƒ½æ¸¬è©¦</h1>
        
        <div class="test-section">
            <h3>ğŸ“‹ ç•¶å‰è¨­å®š</h3>
            <div class="current-settings">
                <pre id="currentSettings">è¼‰å…¥ä¸­...</pre>
            </div>
            <button id="refreshSettings" class="btn btn-secondary">ğŸ”„ é‡æ–°è¼‰å…¥è¨­å®š</button>
        </div>
        
        <div class="test-section">
            <h3>âš™ï¸ API è¨­å®šæ¸¬è©¦</h3>
            
            <div class="input-group">
                <label for="testCompanyDomain">å…¬å¸åŸŸåï¼š</label>
                <input type="text" id="testCompanyDomain" placeholder="ä¾‹å¦‚ï¼šgigabyte" value="gigabyte">
            </div>
            
            <div class="input-group">
                <label for="testLoginApiUrl">ç™»å…¥ APIï¼š</label>
                <input type="url" id="testLoginApiUrl" placeholder="https://your-api.com/login" value="https://hr.gigabyte.com/api/auth/login">
            </div>
            
            <div class="input-group">
                <label for="testAttendanceApiUrl">å‡ºå‹¤æŸ¥è©¢ APIï¼š</label>
                <input type="url" id="testAttendanceApiUrl" placeholder="https://your-api.com/attendance" value="https://hr.gigabyte.com/api/getAttendanceInfo">
            </div>
            
            <div class="input-group">
                <button id="saveTestSettings" class="btn btn-primary">ğŸ’¾ å„²å­˜æ¸¬è©¦è¨­å®š</button>
                <button id="resetTestSettings" class="btn btn-secondary">ğŸ”„ é‡ç½®ç‚ºé è¨­</button>
            </div>
            
            <div id="saveResult" class="test-result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ‘¤ ä½¿ç”¨è€…åç¨±å‰ç¶´æ¸¬è©¦</h3>
            
            <div class="input-group">
                <label for="testUsername">ä½¿ç”¨è€…åç¨±ï¼š</label>
                <div class="username-input">
                    <span id="testUsernamePrefix" class="username-prefix">company\</span>
                    <input type="text" id="testUsername" placeholder="username" value="test.user">
                </div>
            </div>
            
            <div class="input-group">
                <label>çµ„åˆçµæœï¼š</label>
                <div id="combinedAccount" style="font-family: monospace; font-weight: bold; color: #495057;">
                    company\test.user
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§ª åŠŸèƒ½æ¸¬è©¦</h3>
            
            <div class="input-group">
                <button id="testLoadSettings" class="btn btn-primary">ğŸ“¥ æ¸¬è©¦è¼‰å…¥è¨­å®š</button>
                <button id="testSaveSettings" class="btn btn-primary">ğŸ’¾ æ¸¬è©¦å„²å­˜è¨­å®š</button>
                <button id="testResetSettings" class="btn btn-secondary">ğŸ”„ æ¸¬è©¦é‡ç½®è¨­å®š</button>
            </div>
            
            <div id="testResults" class="test-result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“± æ“´å……å¥—ä»¶æ•´åˆæ¸¬è©¦</h3>
            <p>åœ¨ Microsoft Edge ä¸­è¼‰å…¥æ­¤æ“´å……å¥—ä»¶ï¼Œç„¶å¾Œæ¸¬è©¦ä»¥ä¸‹åŠŸèƒ½ï¼š</p>
            <ul>
                <li>âœ… API è¨­å®šæŒ‰éˆ•é¡¯ç¤º/éš±è—</li>
                <li>âœ… å…¬å¸åŸŸåå³æ™‚æ›´æ–°å‰ç¶´</li>
                <li>âœ… è¨­å®šå„²å­˜å’Œè¼‰å…¥</li>
                <li>âœ… é‡ç½®ç‚ºé è¨­å€¼</li>
                <li>âœ… ç™»å…¥æ™‚ä½¿ç”¨è‡ªè¨‚åŸŸå</li>
            </ul>
        </div>
    </div>

    <script>
        // æ¨¡æ“¬ API è¨­å®šåŠŸèƒ½
        const DEFAULT_API_SETTINGS = {
            companyDomain: 'company',
            loginApiUrl: 'https://your-company-api.com/api/auth/login',
            attendanceApiUrl: 'https://your-company-api.com/api/getAttendanceInfo'
        };

        let apiSettings = { ...DEFAULT_API_SETTINGS };

        // æ¨¡æ“¬å„²å­˜å‡½æ•¸
        function setStorage(data) {
            return new Promise((resolve) => {
                Object.keys(data).forEach(key => {
                    localStorage.setItem(key, JSON.stringify(data[key]));
                });
                resolve();
            });
        }

        function getStorage(key) {
            return new Promise((resolve) => {
                const value = localStorage.getItem(key);
                resolve(value ? JSON.parse(value) : null);
            });
        }

        // è¼‰å…¥è¨­å®š
        async function loadApiSettings() {
            try {
                const saved = await getStorage('apiSettings');
                if (saved) {
                    apiSettings = { ...DEFAULT_API_SETTINGS, ...saved };
                }
                updateUI();
                showResult('testResults', 'âœ… è¨­å®šè¼‰å…¥æˆåŠŸ', 'success');
            } catch (error) {
                showResult('testResults', 'âŒ è¼‰å…¥å¤±æ•—ï¼š' + error.message, 'error');
            }
        }

        // å„²å­˜è¨­å®š
        async function saveApiSettings() {
            try {
                apiSettings.companyDomain = document.getElementById('testCompanyDomain').value.trim() || 'company';
                apiSettings.loginApiUrl = document.getElementById('testLoginApiUrl').value.trim() || DEFAULT_API_SETTINGS.loginApiUrl;
                apiSettings.attendanceApiUrl = document.getElementById('testAttendanceApiUrl').value.trim() || DEFAULT_API_SETTINGS.attendanceApiUrl;
                
                await setStorage({ apiSettings });
                updateUI();
                showResult('saveResult', 'âœ… è¨­å®šå·²å„²å­˜', 'success');
                showResult('testResults', 'âœ… è¨­å®šå„²å­˜æˆåŠŸ', 'success');
            } catch (error) {
                showResult('saveResult', 'âŒ å„²å­˜å¤±æ•—ï¼š' + error.message, 'error');
                showResult('testResults', 'âŒ å„²å­˜å¤±æ•—ï¼š' + error.message, 'error');
            }
        }

        // é‡ç½®è¨­å®š
        function resetApiSettings() {
            apiSettings = { ...DEFAULT_API_SETTINGS };
            updateUI();
            showResult('saveResult', 'ğŸ”„ å·²é‡ç½®ç‚ºé è¨­è¨­å®š', 'success');
            showResult('testResults', 'ğŸ”„ é‡ç½®æˆåŠŸ', 'success');
        }

        // æ›´æ–° UI
        function updateUI() {
            document.getElementById('testCompanyDomain').value = apiSettings.companyDomain;
            document.getElementById('testLoginApiUrl').value = apiSettings.loginApiUrl;
            document.getElementById('testAttendanceApiUrl').value = apiSettings.attendanceApiUrl;
            
            // æ›´æ–°å‰ç¶´
            document.getElementById('testUsernamePrefix').textContent = `${apiSettings.companyDomain}\\`;
            
            // æ›´æ–°çµ„åˆçµæœ
            const username = document.getElementById('testUsername').value;
            document.getElementById('combinedAccount').textContent = `${apiSettings.companyDomain}\\${username}`;
            
            // æ›´æ–°ç•¶å‰è¨­å®šé¡¯ç¤º
            document.getElementById('currentSettings').textContent = JSON.stringify(apiSettings, null, 2);
        }

        // é¡¯ç¤ºçµæœ
        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `test-result ${type}`;
            element.style.display = 'block';
            
            setTimeout(() => {
                element.style.display = 'none';
            }, 3000);
        }

        // äº‹ä»¶ç›£è½å™¨
        document.addEventListener('DOMContentLoaded', function() {
            loadApiSettings();
            
            // è¨­å®šæŒ‰éˆ•
            document.getElementById('saveTestSettings').addEventListener('click', saveApiSettings);
            document.getElementById('resetTestSettings').addEventListener('click', resetApiSettings);
            document.getElementById('refreshSettings').addEventListener('click', loadApiSettings);
            
            // æ¸¬è©¦æŒ‰éˆ•
            document.getElementById('testLoadSettings').addEventListener('click', loadApiSettings);
            document.getElementById('testSaveSettings').addEventListener('click', saveApiSettings);
            document.getElementById('testResetSettings').addEventListener('click', resetApiSettings);
            
            // å³æ™‚æ›´æ–°
            document.getElementById('testCompanyDomain').addEventListener('input', function() {
                const domain = this.value.trim() || 'company';
                document.getElementById('testUsernamePrefix').textContent = `${domain}\\`;
                
                const username = document.getElementById('testUsername').value;
                document.getElementById('combinedAccount').textContent = `${domain}\\${username}`;
            });
            
            document.getElementById('testUsername').addEventListener('input', function() {
                const domain = document.getElementById('testCompanyDomain').value.trim() || 'company';
                document.getElementById('combinedAccount').textContent = `${domain}\\${this.value}`;
            });
        });
    </script>
</body>
</html>
